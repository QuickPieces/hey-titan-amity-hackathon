# Amity Social Cloud Typescript SDK

### Disclaimer

**The build is a beta release, which may not be fully stable. Both SDK and documentation are subject to change.**

## Getting Started

- With npm: `npm install @amityco/ts-sdk`
- With yarn: `yarn add @amityco/ts-sdk`

## Runtime support

- Modern browsers (es2017 compliant)
- NodeJS (via esm imports)
- React-Native

## Creating a client instance

To connect your users to our platform, you need to create a client instance and connect it.

```ts
import {
  createClient,
  connectClient,
} from '@amityco/ts-sdk'

(async () => {
  const client = createClient(API_KEY, API_REGION)
  let isConnected = await connectClient({ userId: USER_ID })
})()
```

The `API_KEY` and `API_REGION` are given at the time you create an application in the [Amity Portal](http://portal.amity.co/).

You can listen to disconnection by using the `onClientDisconnected` function:

```ts
import { onClientDisconnected } from '@amityco/ts-sdk'

const unsub = onClientDisconnected(() => isConnected = false)
```

The `unsub`'s return value is a _dispose function_ which is used to clean the memory of your client's application. It's been designed to fit perfectly with React, in a useEffect such as:

```ts
useEffect(() => onClientConnected(() => setConnected(false)), [])
```

## Enabling cache

In most of the application, you will want to enable our client cache system. This will save bandwidth for your users, and enable features such as optimistic mutations, and with proper configuration, offline mode.

To enable in memory _(per session)_ cache, you need to call the `enableCache` function once:

```ts
import {
  createClient,
  connectClient,
  enableCache,
} from '@amityco/ts-sdk'

(async () => {
  const client = createClient(API_KEY, API_REGION)
  enableCache()

  let isConnected = await connectClient({ userId: USER_ID })
})()
```

## Going further

### Domain types

All the necessary types are automatically exposed in the `Amity` namespace. As long as you import the SDK once, the namespace will be available in your workspace. You can start to type `Amity.` and see the list of types in your intellisense after having imported the SDK in any file of your project.

### Fetching a user from the server

The most-forward way to use the SDK will be with simple asynchronous functions. These are particularly interesting in cases of server-side use, such as NextJS SSR or even to create small automation through lambda functions.

```ts
import { getUser } from '@amityco/ts-sdk'

(async () => {
  const user = await getUser('userId')
})()
```

### Working with the cache

To query things _"offline-first"_, you'll have to wrap the function into a `Amity.Query` object. The query can then be passed into the `runQuery` function which will control the flow of your query, working around with the cache to pull data the fastest possible.

The `runQuery` function will call your callback as soon as a value is available, and the returned result will be wrapped in a `Amity.Snapshot<T>`, containing additional `error?: Error` and `loading?: boolean` properties which you can use to control the state of your application.

```ts
import {
  getUser, createQuery, runQuery,
} from '@amityco/ts-sdk'

const query = createQuery(getUser, 'userId')

runQuery(query, ({ data: user, error }) => {
  if (error) throw error
  console.log(user)
})
```

### Reacting to a server change

We expose a couple of functions for your to receive simply the events that could fire from our servers, for example, if another user would change their display name, or if a channel would receive a new message.

Similarly to the `onClientDisconnected` function, every `onXXX` function will return a dispose function to clean the memory properly.

```ts
import { onUserUpdated } from '@amityco/ts-sdk'

const unsub = onUserUpdated(user => console.log(user))
```

### Observe an object

For an _'all-in-one'_ approach, we expose _observer_ functions, which allow to fetch an object _and_ register to its changes all at once. This has been designed to fit with React's useState and useEffect nicely:

```ts
import { observeUser } from '@amityco/ts-sdk'

const Component = ({ userId }: { userId: string }) => {
  const [{ data: user }, setData] = useState<Amity.Snapshot<Amity.User>>({})
  useEffect(() => observeUser(userId, setData), [userId])

  return <div>{JSON.stringify(user, null, 2)}
}
```

## Documentation

Contact the team at [developers@amity.co](mailto:developers@amity.co) or on [our community website](https://community.amity.co/) for an early access to our documentation website and enquiries.
